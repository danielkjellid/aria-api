FROM beeyev/thumbor-s3:7.1-slim-alpine

ENV PORT="80"
ENV AUTO_PNG_TO_JPG='True'
ENV AUTO_WEBP='True'
ENV ALLOW_OLD_URLS='False'
ENV ALLOW_UNSAFE_URL='False'

ARG AWS_REGION
ARG AWS_S3_BUCKET_NAME
ARG AWS_ACCESS_KEY_ID
ARG AWS_SECRET_ACCESS_KEY
ARG AWS_ENDPOINT_URL

ENV AWS_LOADER_REGION_NAME=${AWS_REGION}
ENV AWS_LOADER_BUCKET_NAME=${AWS_S3_BUCKET_NAME}
ENV AWS_LOADER_S3_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
ENV AWS_LOADER_S3_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
ENV AWS_LOADER_S3_ENDPOINT_URL=${AWS_ENDPOINT_URL}
ENV AWS_RESULT_STORAGE_S3_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
ENV AWS_RESULT_STORAGE_S3_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
ENV AWS_RESULT_STORAGE_S3_ENDPOINT_URL=${AWS_ENDPOINT_URL}
ENV AWS_RESULT_STORAGE_ROOT_PATH='media/media-cache'
ENV AWS_RESULT_STORAGE_BUCKET_NAME=${AWS_S3_BUCKET_NAME}

ENV LOG_LEVEL=info
ENV LOADER=thumbor_aws.loader
ENV MAX_AGE=86400
ENV MAX_WIDTH=2048
ENV MAX_HEIGHT=1150

ENV RESULT_STORAGE=thumbor_aws.result_storage
ENV RESULT_STORAGE_EXPIRATION_SECONDS=2629746
ENV RESULT_STORAGE_STORES_UNSAFE='False'

ARG THUMBOR_SECURITY_KEY

ENV SECURITY_KEY=${THUMBOR_SECURITY_KEY}

ENV QUALITY=99

EXPOSE ${PORT}